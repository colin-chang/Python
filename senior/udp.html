<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>UDP | Python 修炼手册</title>
    <meta name="generator" content="VuePress 1.5.3">
    <link rel="icon" href="https://i.loli.net/2020/02/25/AOjBhkIxtb8dRgl.png">
    <meta name="description" content="深入浅出的Python学习文档，从Python基础和高级编程到算法数据结构,Web开发，爬虫，大数据和人工智能">
    <link rel="preload" href="/python/assets/css/0.styles.055cc0b1.css" as="style"><link rel="preload" href="/python/assets/js/app.e1ee403d.js" as="script"><link rel="preload" href="/python/assets/js/2.968a03f5.js" as="script"><link rel="preload" href="/python/assets/js/48.e81f8b9b.js" as="script"><link rel="prefetch" href="/python/assets/js/10.012951f0.js"><link rel="prefetch" href="/python/assets/js/11.94282480.js"><link rel="prefetch" href="/python/assets/js/12.44b4fd9e.js"><link rel="prefetch" href="/python/assets/js/13.a13f0565.js"><link rel="prefetch" href="/python/assets/js/14.d8e39cac.js"><link rel="prefetch" href="/python/assets/js/15.46786c41.js"><link rel="prefetch" href="/python/assets/js/16.b85eb3ee.js"><link rel="prefetch" href="/python/assets/js/17.96eaba02.js"><link rel="prefetch" href="/python/assets/js/18.a3db5906.js"><link rel="prefetch" href="/python/assets/js/19.588c0903.js"><link rel="prefetch" href="/python/assets/js/20.34ac6f63.js"><link rel="prefetch" href="/python/assets/js/21.4b026890.js"><link rel="prefetch" href="/python/assets/js/22.5508086b.js"><link rel="prefetch" href="/python/assets/js/23.7d5489f6.js"><link rel="prefetch" href="/python/assets/js/24.2885ce1a.js"><link rel="prefetch" href="/python/assets/js/25.c7bff1ee.js"><link rel="prefetch" href="/python/assets/js/26.f7ed45c0.js"><link rel="prefetch" href="/python/assets/js/27.999c5b6b.js"><link rel="prefetch" href="/python/assets/js/28.fac536a2.js"><link rel="prefetch" href="/python/assets/js/29.2edd588d.js"><link rel="prefetch" href="/python/assets/js/3.00a5d3f8.js"><link rel="prefetch" href="/python/assets/js/30.02da556d.js"><link rel="prefetch" href="/python/assets/js/31.8b2e3d98.js"><link rel="prefetch" href="/python/assets/js/32.b4efad96.js"><link rel="prefetch" href="/python/assets/js/33.85e23546.js"><link rel="prefetch" href="/python/assets/js/34.d1dec00c.js"><link rel="prefetch" href="/python/assets/js/35.b9ff4b4d.js"><link rel="prefetch" href="/python/assets/js/36.00458c5e.js"><link rel="prefetch" href="/python/assets/js/37.b5a94735.js"><link rel="prefetch" href="/python/assets/js/38.f228b7cb.js"><link rel="prefetch" href="/python/assets/js/39.4bd30457.js"><link rel="prefetch" href="/python/assets/js/4.ca72af8b.js"><link rel="prefetch" href="/python/assets/js/40.1d2da048.js"><link rel="prefetch" href="/python/assets/js/41.57a29faf.js"><link rel="prefetch" href="/python/assets/js/42.4f688b9c.js"><link rel="prefetch" href="/python/assets/js/43.914d9eb9.js"><link rel="prefetch" href="/python/assets/js/44.f0e4f09d.js"><link rel="prefetch" href="/python/assets/js/45.9e3d4438.js"><link rel="prefetch" href="/python/assets/js/46.e64c4e17.js"><link rel="prefetch" href="/python/assets/js/47.74008a88.js"><link rel="prefetch" href="/python/assets/js/5.c4e0eacc.js"><link rel="prefetch" href="/python/assets/js/6.68364987.js"><link rel="prefetch" href="/python/assets/js/7.8ab3a63c.js"><link rel="prefetch" href="/python/assets/js/8.9add6df9.js"><link rel="prefetch" href="/python/assets/js/9.c501f952.js">
    <link rel="stylesheet" href="/python/assets/css/0.styles.055cc0b1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/python/" class="home-link router-link-active"><!----> <span class="site-name">Python 修炼手册</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/python/basic/intro.html" class="nav-link">
  Get Start
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Books" class="dropdown-title"><span class="title">Books</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://ccstudio.org/dotnet" target="_blank" rel="noopener noreferrer" class="nav-link external">
  .Net Core
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://ccstudio.org/linux" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Linux
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://ccstudio.org/architecture" target="_blank" rel="noopener noreferrer" class="nav-link external">
  系统架构设计
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="https://ccstudio.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/colin-chang/python" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/python/basic/intro.html" class="nav-link">
  Get Start
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Books" class="dropdown-title"><span class="title">Books</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://ccstudio.org/dotnet" target="_blank" rel="noopener noreferrer" class="nav-link external">
  .Net Core
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://ccstudio.org/linux" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Linux
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://ccstudio.org/architecture" target="_blank" rel="noopener noreferrer" class="nav-link external">
  系统架构设计
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="https://ccstudio.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/colin-chang/python" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Python基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/python/basic/intro.html" class="sidebar-link">Python简介</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/basic/intro.html#_1-python介绍" class="sidebar-link">1. Python介绍</a></li><li class="sidebar-sub-header"><a href="/python/basic/intro.html#_2-python与ai" class="sidebar-link">2. Python与AI</a></li><li class="sidebar-sub-header"><a href="/python/basic/intro.html#_3-python应用场景" class="sidebar-link">3. Python应用场景</a></li><li class="sidebar-sub-header"><a href="/python/basic/intro.html#_4-python版本" class="sidebar-link">4. Python版本</a></li></ul></li><li><a href="/python/basic/ide.html" class="sidebar-link">Python执行方式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/basic/ide.html#_1-解释器执行" class="sidebar-link">1. 解释器执行</a></li><li class="sidebar-sub-header"><a href="/python/basic/ide.html#_2-交互式执行python" class="sidebar-link">2. 交互式执行Python</a></li><li class="sidebar-sub-header"><a href="/python/basic/ide.html#_3-python-ide" class="sidebar-link">3. Python IDE</a></li></ul></li><li><a href="/python/basic/standard.html" class="sidebar-link">代码规范</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/basic/standard.html#_1-注释" class="sidebar-link">1. 注释</a></li><li class="sidebar-sub-header"><a href="/python/basic/standard.html#_2-中文支持" class="sidebar-link">2. 中文支持</a></li><li class="sidebar-sub-header"><a href="/python/basic/standard.html#_3-命名规则" class="sidebar-link">3. 命名规则</a></li><li class="sidebar-sub-header"><a href="/python/basic/standard.html#_4-代码规范" class="sidebar-link">4. 代码规范</a></li><li class="sidebar-sub-header"><a href="/python/basic/standard.html#_5-pass" class="sidebar-link">5. pass</a></li></ul></li><li><a href="/python/basic/io.html" class="sidebar-link">输入输出</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/basic/io.html#_1-输入" class="sidebar-link">1. 输入</a></li><li class="sidebar-sub-header"><a href="/python/basic/io.html#_2-输出" class="sidebar-link">2. 输出</a></li><li class="sidebar-sub-header"><a href="/python/basic/io.html#_3-程序参数" class="sidebar-link">3. 程序参数</a></li></ul></li><li><a href="/python/basic/datatype.html" class="sidebar-link">数据类型</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/basic/datatype.html#_1-数据类型" class="sidebar-link">1. 数据类型</a></li><li class="sidebar-sub-header"><a href="/python/basic/datatype.html#_2-数据类型转换" class="sidebar-link">2. 数据类型转换</a></li><li class="sidebar-sub-header"><a href="/python/basic/datatype.html#_3-对象引用" class="sidebar-link">3. 对象引用</a></li><li class="sidebar-sub-header"><a href="/python/basic/datatype.html#_4-可变类型-不可变类型" class="sidebar-link">4. 可变类型/不可变类型</a></li></ul></li><li><a href="/python/basic/operator.html" class="sidebar-link">运算符</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/basic/operator.html#_1-算术运算符" class="sidebar-link">1. 算术运算符</a></li><li class="sidebar-sub-header"><a href="/python/basic/operator.html#_2-赋值运算符" class="sidebar-link">2. 赋值运算符</a></li><li class="sidebar-sub-header"><a href="/python/basic/operator.html#_3-比较运算符" class="sidebar-link">3. 比较运算符</a></li><li class="sidebar-sub-header"><a href="/python/basic/operator.html#_4-逻辑运算符" class="sidebar-link">4. 逻辑运算符</a></li><li class="sidebar-sub-header"><a href="/python/basic/operator.html#_5-位运算符" class="sidebar-link">5. 位运算符</a></li></ul></li><li><a href="/python/basic/processctrl.html" class="sidebar-link">流控制语句</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/basic/processctrl.html#_1-条件语句" class="sidebar-link">1. 条件语句</a></li><li class="sidebar-sub-header"><a href="/python/basic/processctrl.html#_2-循环语句" class="sidebar-link">2. 循环语句</a></li></ul></li><li><a href="/python/basic/str.html" class="sidebar-link">字符串</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/basic/str.html#_1-字符串基础" class="sidebar-link">1. 字符串基础</a></li><li class="sidebar-sub-header"><a href="/python/basic/str.html#_2-常用操作" class="sidebar-link">2. 常用操作</a></li><li class="sidebar-sub-header"><a href="/python/basic/str.html#_3-正则表达式" class="sidebar-link">3. 正则表达式</a></li></ul></li><li><a href="/python/basic/list.html" class="sidebar-link">列表 / 元组 / 集合</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/basic/list.html#_1-列表" class="sidebar-link">1. 列表</a></li><li class="sidebar-sub-header"><a href="/python/basic/list.html#_2-元组" class="sidebar-link">2. 元组</a></li><li class="sidebar-sub-header"><a href="/python/basic/list.html#_3-集合" class="sidebar-link">3. 集合</a></li></ul></li><li><a href="/python/basic/dict.html" class="sidebar-link">字典</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/basic/dict.html#_1-字典简介" class="sidebar-link">1. 字典简介</a></li><li class="sidebar-sub-header"><a href="/python/basic/dict.html#_2-crud" class="sidebar-link">2. CRUD</a></li><li class="sidebar-sub-header"><a href="/python/basic/dict.html#_3-遍历" class="sidebar-link">3. 遍历</a></li></ul></li><li><a href="/python/basic/function.html" class="sidebar-link">函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/basic/function.html#_1-声明调用" class="sidebar-link">1. 声明调用</a></li><li class="sidebar-sub-header"><a href="/python/basic/function.html#_2-函数参数" class="sidebar-link">2. 函数参数</a></li><li class="sidebar-sub-header"><a href="/python/basic/function.html#_3-作用域" class="sidebar-link">3. 作用域</a></li><li class="sidebar-sub-header"><a href="/python/basic/function.html#_4-lambda-匿名函数" class="sidebar-link">4. lambda 匿名函数</a></li><li class="sidebar-sub-header"><a href="/python/basic/function.html#_5-闭包" class="sidebar-link">5. 闭包</a></li><li class="sidebar-sub-header"><a href="/python/basic/function.html#_6-内建函数" class="sidebar-link">6. 内建函数</a></li></ul></li><li><a href="/python/basic/oo.html" class="sidebar-link">面向对象</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/basic/oo.html#_1-类" class="sidebar-link">1. 类</a></li><li class="sidebar-sub-header"><a href="/python/basic/oo.html#_2-类内建属性和方法" class="sidebar-link">2. 类内建属性和方法</a></li><li class="sidebar-sub-header"><a href="/python/basic/oo.html#_3-property" class="sidebar-link">3. property</a></li><li class="sidebar-sub-header"><a href="/python/basic/oo.html#_4-类级别成员" class="sidebar-link">4. 类级别成员</a></li><li class="sidebar-sub-header"><a href="/python/basic/oo.html#_5-继承" class="sidebar-link">5. 继承</a></li><li class="sidebar-sub-header"><a href="/python/basic/oo.html#_6-多态" class="sidebar-link">6. 多态</a></li></ul></li><li><a href="/python/basic/module.html" class="sidebar-link">模块 / 包</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/basic/module.html#_1-模块简介" class="sidebar-link">1. 模块简介</a></li><li class="sidebar-sub-header"><a href="/python/basic/module.html#_2-导入模块" class="sidebar-link">2. 导入模块</a></li><li class="sidebar-sub-header"><a href="/python/basic/module.html#_3-模块高级" class="sidebar-link">3. 模块高级</a></li><li class="sidebar-sub-header"><a href="/python/basic/module.html#_4-包" class="sidebar-link">4. 包</a></li><li class="sidebar-sub-header"><a href="/python/basic/module.html#_5-标准库" class="sidebar-link">5. 标准库</a></li></ul></li><li><a href="/python/basic/accessibility.html" class="sidebar-link">可访问性</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/basic/accessibility.html#_1-可访问性" class="sidebar-link">1. 可访问性</a></li><li class="sidebar-sub-header"><a href="/python/basic/accessibility.html#_2-名字重整" class="sidebar-link">2. 名字重整</a></li></ul></li><li><a href="/python/basic/copy.html" class="sidebar-link">深拷贝与浅拷贝</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/basic/copy.html#_1-深拷贝与浅拷贝" class="sidebar-link">1. 深拷贝与浅拷贝</a></li><li class="sidebar-sub-header"><a href="/python/basic/copy.html#_2-浅拷贝" class="sidebar-link">2. 浅拷贝</a></li><li class="sidebar-sub-header"><a href="/python/basic/copy.html#_3-深拷贝" class="sidebar-link">3. 深拷贝</a></li><li class="sidebar-sub-header"><a href="/python/basic/copy.html#_4-copy-copy" class="sidebar-link">4. copy.copy()</a></li></ul></li><li><a href="/python/basic/file.html" class="sidebar-link">文件操作</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/basic/file.html#_1-文件读写" class="sidebar-link">1. 文件读写</a></li><li class="sidebar-sub-header"><a href="/python/basic/file.html#_2-文件-目录操作" class="sidebar-link">2. 文件 / 目录操作</a></li><li class="sidebar-sub-header"><a href="/python/basic/file.html#_3-路径操作" class="sidebar-link">3. 路径操作</a></li><li class="sidebar-sub-header"><a href="/python/basic/file.html#_4-案例" class="sidebar-link">4.案例</a></li></ul></li><li><a href="/python/basic/exception.html" class="sidebar-link">异常处理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/basic/exception.html#_1-异常基本处理" class="sidebar-link">1. 异常基本处理</a></li><li class="sidebar-sub-header"><a href="/python/basic/exception.html#_2-自定义异常" class="sidebar-link">2. 自定义异常</a></li></ul></li><li><a href="/python/basic/logging.html" class="sidebar-link">日志处理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/basic/logging.html#_1-logging-简单日志" class="sidebar-link">1. logging 简单日志</a></li><li class="sidebar-sub-header"><a href="/python/basic/logging.html#_2-logging-组件" class="sidebar-link">2. logging 组件</a></li><li class="sidebar-sub-header"><a href="/python/basic/logging.html#_3-日志处理" class="sidebar-link">3. 日志处理</a></li><li class="sidebar-sub-header"><a href="/python/basic/logging.html#_4-日志配置" class="sidebar-link">4. 日志配置</a></li><li class="sidebar-sub-header"><a href="/python/basic/logging.html#_5-记录上下文信息" class="sidebar-link">5. 记录上下文信息</a></li><li class="sidebar-sub-header"><a href="/python/basic/logging.html#_6-分布式日志" class="sidebar-link">6. 分布式日志</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Python高级</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/python/senior/generator.html" class="sidebar-link">生成器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/senior/generator.html#_1-生成器" class="sidebar-link">1. 生成器</a></li><li class="sidebar-sub-header"><a href="/python/senior/generator.html#_2-生成器推导式" class="sidebar-link">2. 生成器推导式</a></li><li class="sidebar-sub-header"><a href="/python/senior/generator.html#_3-yield" class="sidebar-link">3. yield</a></li><li class="sidebar-sub-header"><a href="/python/senior/generator.html#_4-send" class="sidebar-link">4. send</a></li></ul></li><li><a href="/python/senior/iterator.html" class="sidebar-link">迭代器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/senior/iterator.html#_1-可迭代对象" class="sidebar-link">1. 可迭代对象</a></li><li class="sidebar-sub-header"><a href="/python/senior/iterator.html#_2-迭代器" class="sidebar-link">2. 迭代器</a></li></ul></li><li><a href="/python/senior/decorator.html" class="sidebar-link">装饰器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/senior/decorator.html#_1-装饰器" class="sidebar-link">1. 装饰器</a></li><li class="sidebar-sub-header"><a href="/python/senior/decorator.html#_2-多装饰器" class="sidebar-link">2. 多装饰器</a></li><li class="sidebar-sub-header"><a href="/python/senior/decorator.html#_3-参数与返回值" class="sidebar-link">3. 参数与返回值</a></li><li class="sidebar-sub-header"><a href="/python/senior/decorator.html#_4-有参装饰器" class="sidebar-link">4. 有参装饰器</a></li><li class="sidebar-sub-header"><a href="/python/senior/decorator.html#_5-类装饰器" class="sidebar-link">5. 类装饰器</a></li><li class="sidebar-sub-header"><a href="/python/senior/decorator.html#_6-wraps-装饰器" class="sidebar-link">6. wraps 装饰器</a></li></ul></li><li><a href="/python/senior/contextmanager.html" class="sidebar-link">上下文管理器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/senior/contextmanager.html#_1-上下文管理器" class="sidebar-link">1. 上下文管理器</a></li><li class="sidebar-sub-header"><a href="/python/senior/contextmanager.html#_2-contextmanager" class="sidebar-link">2. contextmanager</a></li></ul></li><li><a href="/python/senior/dynamic.html" class="sidebar-link">动态扩展</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/senior/dynamic.html#_1-动态语言" class="sidebar-link">1. 动态语言</a></li><li class="sidebar-sub-header"><a href="/python/senior/dynamic.html#_2-动态扩展对象" class="sidebar-link">2. 动态扩展对象</a></li><li class="sidebar-sub-header"><a href="/python/senior/dynamic.html#_3-slots" class="sidebar-link">3. __slots__</a></li></ul></li><li><a href="/python/senior/metaclass.html" class="sidebar-link">元类</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/senior/metaclass.html#_1-类对象" class="sidebar-link">1. 类对象</a></li><li class="sidebar-sub-header"><a href="/python/senior/metaclass.html#_2-type-类" class="sidebar-link">2. type 类</a></li><li class="sidebar-sub-header"><a href="/python/senior/metaclass.html#_3-元类" class="sidebar-link">3. 元类</a></li></ul></li><li><a href="/python/senior/intern.html" class="sidebar-link">对象池与intern</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/senior/intern.html#_1-字母小整数对象池" class="sidebar-link">1. 字母小整数对象池</a></li><li class="sidebar-sub-header"><a href="/python/senior/intern.html#_2-intern" class="sidebar-link">2. intern</a></li></ul></li><li><a href="/python/senior/gc.html" class="sidebar-link">垃圾回收（GC）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/senior/gc.html#_1-引用计数" class="sidebar-link">1. 引用计数</a></li><li class="sidebar-sub-header"><a href="/python/senior/gc.html#_2-分代回收" class="sidebar-link">2. 分代回收</a></li><li class="sidebar-sub-header"><a href="/python/senior/gc.html#_3-gc-模块" class="sidebar-link">3. gc 模块</a></li></ul></li><li><a href="/python/senior/pdb.html" class="sidebar-link">pdb 调试工具</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/senior/pdb.html#_1-使用方式" class="sidebar-link">1. 使用方式</a></li><li class="sidebar-sub-header"><a href="/python/senior/pdb.html#_2-pdb命令" class="sidebar-link">2. pdb命令</a></li></ul></li><li><a href="/python/senior/process.html" class="sidebar-link">多进程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/senior/process.html#_1-fork" class="sidebar-link">1. fork</a></li><li class="sidebar-sub-header"><a href="/python/senior/process.html#_2-process" class="sidebar-link">2. Process</a></li><li class="sidebar-sub-header"><a href="/python/senior/process.html#_3-进程池" class="sidebar-link">3. 进程池</a></li><li class="sidebar-sub-header"><a href="/python/senior/process.html#_4-进程间通信-ipc" class="sidebar-link">4. 进程间通信(IPC)</a></li><li class="sidebar-sub-header"><a href="/python/senior/process.html#_5-cow" class="sidebar-link">5. COW</a></li></ul></li><li><a href="/python/senior/thread.html" class="sidebar-link">多线程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/senior/thread.html#_1-多线程" class="sidebar-link">1. 多线程</a></li><li class="sidebar-sub-header"><a href="/python/senior/thread.html#_2-线程同步" class="sidebar-link">2. 线程同步</a></li><li class="sidebar-sub-header"><a href="/python/senior/thread.html#_3-数据共享" class="sidebar-link">3. 数据共享</a></li><li class="sidebar-sub-header"><a href="/python/senior/thread.html#_4-全局解释器锁-gil" class="sidebar-link">4. 全局解释器锁 (GIL)</a></li></ul></li><li><a href="/python/senior/coroutine.html" class="sidebar-link">协程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/senior/coroutine.html#_1-协程" class="sidebar-link">1. 协程</a></li><li class="sidebar-sub-header"><a href="/python/senior/coroutine.html#_2-yield-协程" class="sidebar-link">2. yield 协程</a></li><li class="sidebar-sub-header"><a href="/python/senior/coroutine.html#_3-greenlet" class="sidebar-link">3. greenlet</a></li><li class="sidebar-sub-header"><a href="/python/senior/coroutine.html#_4-gevent" class="sidebar-link">4. gevent</a></li></ul></li><li><a href="/python/senior/network.html" class="sidebar-link">网络通信</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/senior/network.html#_1-tcp-ip" class="sidebar-link">1. TCP/IP</a></li><li class="sidebar-sub-header"><a href="/python/senior/network.html#_2-划分子网" class="sidebar-link">2. 划分子网</a></li><li class="sidebar-sub-header"><a href="/python/senior/network.html#_3-局域网组网" class="sidebar-link">3. 局域网组网</a></li><li class="sidebar-sub-header"><a href="/python/senior/network.html#_4-跨网络通信" class="sidebar-link">4. 跨网络通信</a></li><li class="sidebar-sub-header"><a href="/python/senior/network.html#_5-dns" class="sidebar-link">5. DNS</a></li><li class="sidebar-sub-header"><a href="/python/senior/network.html#_6-常见网络攻击" class="sidebar-link">6. 常见网络攻击</a></li></ul></li><li><a href="/python/senior/udp.html" aria-current="page" class="active sidebar-link">UDP</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/senior/udp.html#_1-socket" class="sidebar-link">1. Socket</a></li><li class="sidebar-sub-header"><a href="/python/senior/udp.html#_2-udp-协议" class="sidebar-link">2. UDP 协议</a></li><li class="sidebar-sub-header"><a href="/python/senior/udp.html#_3-udp-socket" class="sidebar-link">3. UDP Socket</a></li><li class="sidebar-sub-header"><a href="/python/senior/udp.html#_4-tftp" class="sidebar-link">4. TFTP</a></li></ul></li><li><a href="/python/senior/tcp.html" class="sidebar-link">TCP</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/senior/tcp.html#_1-三次握手" class="sidebar-link">1. 三次握手</a></li><li class="sidebar-sub-header"><a href="/python/senior/tcp.html#_2-四次挥手" class="sidebar-link">2. 四次挥手</a></li><li class="sidebar-sub-header"><a href="/python/senior/tcp.html#_3-2msl" class="sidebar-link">3. 2MSL</a></li><li class="sidebar-sub-header"><a href="/python/senior/tcp.html#_4-tcp-socket" class="sidebar-link">4. TCP Socket</a></li><li class="sidebar-sub-header"><a href="/python/senior/tcp.html#_5-长连接与短连接" class="sidebar-link">5. 长连接与短连接</a></li><li class="sidebar-sub-header"><a href="/python/senior/tcp.html#_6-多任务tcp服务器" class="sidebar-link">6. 多任务TCP服务器</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>算法与数据结构</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/python/datastructure/algorithm.html" class="sidebar-link">算法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/datastructure/algorithm.html#_1-算法" class="sidebar-link">1. 算法</a></li><li class="sidebar-sub-header"><a href="/python/datastructure/algorithm.html#_2-时间复杂度" class="sidebar-link">2. 时间复杂度</a></li><li class="sidebar-sub-header"><a href="/python/datastructure/algorithm.html#_3-timeit" class="sidebar-link">3. timeit</a></li></ul></li><li><a href="/python/datastructure/sort.html" class="sidebar-link">排序算法与搜索算法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/datastructure/sort.html#_1-排序算法的稳定性" class="sidebar-link">1. 排序算法的稳定性</a></li><li class="sidebar-sub-header"><a href="/python/datastructure/sort.html#_2-冒泡排序" class="sidebar-link">2. 冒泡排序</a></li><li class="sidebar-sub-header"><a href="/python/datastructure/sort.html#_3-选择排序" class="sidebar-link">3. 选择排序</a></li><li class="sidebar-sub-header"><a href="/python/datastructure/sort.html#_4-插入排序" class="sidebar-link">4. 插入排序</a></li><li class="sidebar-sub-header"><a href="/python/datastructure/sort.html#_5-希尔排序" class="sidebar-link">5. 希尔排序</a></li><li class="sidebar-sub-header"><a href="/python/datastructure/sort.html#_6-归并排序" class="sidebar-link">6. 归并排序</a></li><li class="sidebar-sub-header"><a href="/python/datastructure/sort.html#_7-快速排序" class="sidebar-link">7. 快速排序</a></li><li class="sidebar-sub-header"><a href="/python/datastructure/sort.html#_8-排序算法效率" class="sidebar-link">8. 排序算法效率</a></li><li class="sidebar-sub-header"><a href="/python/datastructure/sort.html#_9-搜索" class="sidebar-link">9. 搜索</a></li></ul></li><li><a href="/python/datastructure/datastructure.html" class="sidebar-link">数据结构</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/datastructure/datastructure.html#_1-数据结构" class="sidebar-link">1. 数据结构</a></li><li class="sidebar-sub-header"><a href="/python/datastructure/datastructure.html#_2-算法与数据结构" class="sidebar-link">2. 算法与数据结构</a></li><li class="sidebar-sub-header"><a href="/python/datastructure/datastructure.html#_3-抽象数据类型-adt" class="sidebar-link">3. 抽象数据类型(ADT)</a></li></ul></li><li><a href="/python/datastructure/sequencelist.html" class="sidebar-link">顺序表</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/datastructure/sequencelist.html#_1-线性表" class="sidebar-link">1. 线性表</a></li><li class="sidebar-sub-header"><a href="/python/datastructure/sequencelist.html#_2-顺序表" class="sidebar-link">2. 顺序表</a></li><li class="sidebar-sub-header"><a href="/python/datastructure/sequencelist.html#_3-存储方式" class="sidebar-link">3. 存储方式</a></li><li class="sidebar-sub-header"><a href="/python/datastructure/sequencelist.html#_4-存储结构" class="sidebar-link">4. 存储结构</a></li><li class="sidebar-sub-header"><a href="/python/datastructure/sequencelist.html#_5-常用操作" class="sidebar-link">5. 常用操作</a></li><li class="sidebar-sub-header"><a href="/python/datastructure/sequencelist.html#_6-python-顺序表" class="sidebar-link">6. Python 顺序表</a></li></ul></li><li><a href="/python/datastructure/linkedlist.html" class="sidebar-link">链表</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/datastructure/linkedlist.html#_1-链表" class="sidebar-link">1. 链表</a></li><li class="sidebar-sub-header"><a href="/python/datastructure/linkedlist.html#_2-单向链表" class="sidebar-link">2. 单向链表</a></li><li class="sidebar-sub-header"><a href="/python/datastructure/linkedlist.html#_3-单向循环链表" class="sidebar-link">3. 单向循环链表</a></li><li class="sidebar-sub-header"><a href="/python/datastructure/linkedlist.html#_4-双向链表" class="sidebar-link">4. 双向链表</a></li><li class="sidebar-sub-header"><a href="/python/datastructure/linkedlist.html#_5-顺序表与链表" class="sidebar-link">5. 顺序表与链表</a></li><li class="sidebar-sub-header"><a href="/python/datastructure/linkedlist.html#_6-python-链表" class="sidebar-link">6. Python 链表</a></li></ul></li><li><a href="/python/datastructure/stackqueue.html" class="sidebar-link">栈 / 队列</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/datastructure/stackqueue.html#_1-栈" class="sidebar-link">1. 栈</a></li><li class="sidebar-sub-header"><a href="/python/datastructure/stackqueue.html#_2-队列" class="sidebar-link">2. 队列</a></li><li class="sidebar-sub-header"><a href="/python/datastructure/stackqueue.html#_3-双端队列" class="sidebar-link">3. 双端队列</a></li></ul></li><li><a href="/python/datastructure/tree.html" class="sidebar-link">树</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/datastructure/tree.html#_1-树" class="sidebar-link">1. 树</a></li><li class="sidebar-sub-header"><a href="/python/datastructure/tree.html#_2-二叉树" class="sidebar-link">2. 二叉树</a></li><li class="sidebar-sub-header"><a href="/python/datastructure/tree.html#_3-构建二叉树" class="sidebar-link">3. 构建二叉树</a></li><li class="sidebar-sub-header"><a href="/python/datastructure/tree.html#_4-遍历二叉树" class="sidebar-link">4. 遍历二叉树</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>数据操作</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/python/database/mysql.html" class="sidebar-link">MySQL</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/database/mysql.html#_1-mysql" class="sidebar-link">1. MySQL</a></li><li class="sidebar-sub-header"><a href="/python/database/mysql.html#_2-pymysql" class="sidebar-link">2. PyMySQL</a></li><li class="sidebar-sub-header"><a href="/python/database/mysql.html#_3-sqlhelper" class="sidebar-link">3. SqlHelper</a></li></ul></li><li><a href="/python/database/redis.html" class="sidebar-link">Redis</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/database/redis.html#_1-redis-交互" class="sidebar-link">1. Redis 交互</a></li><li class="sidebar-sub-header"><a href="/python/database/redis.html#_2-redis-集群交互" class="sidebar-link">2. Redis 集群交互</a></li></ul></li><li><a href="/python/database/mongo.html" class="sidebar-link">MongoDB</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="udp"><a href="#udp" class="header-anchor">#</a> UDP</h1> <h2 id="_1-socket"><a href="#_1-socket" class="header-anchor">#</a> 1. Socket</h2> <p>操作系统内核封装了应用程序间的网络通信模块，并将其命名为Socket。现在Socket更多的代表的是进程间通过网络通信的一种方式，我们网络上各种各样的服务大多都是基于Socket来完成通信的。</p> <p>在Python中使用<code>socket</code>非常简单,<code>socket</code>模块中封装了<code>socket</code>相关对象。</p> <ul><li>Python中<code>socket</code>对象为全双工通信，可以同时收发消息，即可作为客户端也可做服务端。</li> <li>每次创建<code>socket</code>对象都会使用随机的端口号。一般情况下，服务器需要绑定端口让客户端能够正确发送到此进程。</li></ul> <div class="language-py line-numbers-mode"><pre class="language-py"><code><span class="token keyword">from</span> socket <span class="token keyword">import</span> <span class="token operator">*</span>

tcp_socket <span class="token operator">=</span> socket<span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> SOCK_STREAM<span class="token punctuation">)</span>  <span class="token comment"># 创建跨主机TCP socket</span>
udp_socket <span class="token operator">=</span> socket<span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> SOCK_DGRAM<span class="token punctuation">)</span>  <span class="token comment"># 创建跨主机UDP socket</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>family</code>：可选<code>AF_INET</code>(跨主机进程通信)或<code>AF_UNIX</code>(本机进程通信)</li> <li><code>type</code>：<code>socket</code>类型可选<code>SOCK_STREAM</code>(流式套接字，主要用于TCP协议)或者<code>SOCK_DGRAM</code>(数据报套接字，主要用于UDP协议)</li></ul> <h2 id="_2-udp-协议"><a href="#_2-udp-协议" class="header-anchor">#</a> 2. UDP 协议</h2> <p>UDP为用户数据报协议，是一个无连接的面向数据报的运输层协议。UDP不提供可靠性，它只是把应用程序传给IP层的数据报发送出去，但是并不能保证它们能到达目的地。由于UDP在传输数据报前不用在客户和服务器之间建立一个连接，且没有超时重发等机制，故而传输速度很快。</p> <p>UDP数据包括目的端口号和源端口号信息，由于通讯不需要连接，所以可以实现广播发送。UDP传输数据时有大小限制，每个被传输的数据报必须限定在64KB之内。UDP是一个不可靠的协议，发送方所发送的数据报并不一定以相同的次序到达接收方。</p> <p>UDP一般用于多点通信和实时的数据业务，比如视频会议系统,语音广播,DNS等。</p> <p><img src="https://i.loli.net/2020/02/25/3yet94kmlIcosMS.jpg" alt="UDP网络通信过程"></p> <p>UDP的网络通信过程如上图所示。客户端发送消息是消息被逐层组包的一个过程。客户端应用层传输字符串消息Hello，消息到达传输层后附加目标端口等信息，到达网络层后则会附加目标IP地址等信息，到达链路层后会附加目标MAC地址等信息，然后数据包进入物理网络开始传输。</p> <p>数据经由网络路由到达服务端后，服务端则会经历一个与客户端过程相反的解包过程。数据包首先到达链路层，链路层判断数据包MAC地址是否为当前设备，如果不是则直接丢弃数据包，否则进入网络层，网络层会判断数据包IP地址与当前IP是否匹配，如果不匹配则丢弃，否则进入传输层，传输层判断数据包断后与当前程序绑定端口是否一致，不一致则丢弃，否则进入应用层。应用层最终接收到的数据就是客户端最初发送的数据。</p> <p>综合来看，UDP的网络通讯会经理客户端组包，服务端解包的两个过程，类似于电商网购的过程，卖家需要组包商品然后通过物流网络发货，买家收到货物后验证信息是否正确并逐层拆去包装最终拿到商品。</p> <h2 id="_3-udp-socket"><a href="#_3-udp-socket" class="header-anchor">#</a> 3. UDP Socket</h2> <p><img src="https://i.loli.net/2020/02/25/6YZ3iGpoKzUdJRc.jpg" alt="UDP 通信模型"></p> <h3 id="_3-1-基本用法"><a href="#_3-1-基本用法" class="header-anchor">#</a> 3.1 基本用法</h3> <table><thead><tr><th style="text-align:left;">基本函数</th> <th style="text-align:left;">功能</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>sendto(data,('hostaddr',port))</code></td> <td style="text-align:left;">发送数据。<code>data</code>如果是字符串需要进行编码</td></tr> <tr><td style="text-align:left;"><code>recvfrom(buffersize)</code></td> <td style="text-align:left;">接收数据。返回值为<code>(data, address info)</code></td></tr> <tr><td style="text-align:left;"><code>bind(('hostaddr',port))</code></td> <td style="text-align:left;">绑定地址。<code>hostaddr</code>为空则会绑定本机所有可用地址(多网卡)</td></tr> <tr><td style="text-align:left;"><code>close()</code></td> <td style="text-align:left;">关闭连接</td></tr></tbody></table> <div class="language-py line-numbers-mode"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br></div><pre class="language-py"><code><span class="token keyword">from</span> socket <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token comment"># 客户端</span>
udp_client <span class="token operator">=</span> socket<span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> SOCK_DGRAM<span class="token punctuation">)</span>  <span class="token comment"># 创建跨主机UDP socket</span>
msg <span class="token operator">=</span> <span class="token string">&quot;测试消息&quot;</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">&quot;gb2312&quot;</span><span class="token punctuation">)</span>  <span class="token comment"># 处理编码问题</span>
<span class="token comment"># msg = b&quot;test message&quot;</span>
udp_client<span class="token punctuation">.</span>sendto<span class="token punctuation">(</span>msg<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;192.168.0.200&quot;</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 发送数据</span>
udp_client<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 服务器</span>
udp_server <span class="token operator">=</span> socket<span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> SOCK_DGRAM<span class="token punctuation">)</span>
udp_server<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># ''表示绑定本机所有可用IP，8080为绑定端口</span>
msg<span class="token punctuation">,</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span>port<span class="token punctuation">)</span> <span class="token operator">=</span> udp_client<span class="token punctuation">.</span>recvfrom<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>  <span class="token comment"># 阻塞等待接收消息。1024表示每次接收最大字节数</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">&quot;gb2312&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
udp_server<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>下面是UDP两个简单案例。</p> <h4 id="_1）echo服务器"><a href="#_1）echo服务器" class="header-anchor">#</a> 1）echo服务器</h4> <p>接收到客户端消息并原样原路返回消息的服务端称为echo服务器，一般用来测试网络是否可用。</p> <div class="language-py line-numbers-mode"><pre class="language-py"><code><span class="token keyword">from</span> socket <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    echo <span class="token operator">=</span> socket<span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> SOCK_DGRAM<span class="token punctuation">)</span>
    echo<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        msg<span class="token punctuation">,</span> src <span class="token operator">=</span> echo<span class="token punctuation">.</span>recvfrom<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
        echo<span class="token punctuation">.</span>sendto<span class="token punctuation">(</span>msg<span class="token punctuation">,</span> src<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;received %s from %s&quot;</span> <span class="token operator">%</span> <span class="token punctuation">(</span>msg<span class="token punctuation">,</span> src<span class="token punctuation">)</span><span class="token punctuation">)</span>

    echo<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h4 id="_2-即时聊天软件"><a href="#_2-即时聊天软件" class="header-anchor">#</a> 2) 即时聊天软件</h4> <div class="language-py line-numbers-mode"><pre class="language-py"><code><span class="token keyword">from</span> socket <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> threading <span class="token keyword">import</span> Thread
<span class="token keyword">from</span> time <span class="token keyword">import</span> ctime


<span class="token keyword">def</span> <span class="token function">receive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        msg<span class="token punctuation">,</span> <span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">)</span> <span class="token operator">=</span> skt<span class="token punctuation">.</span>recvfrom<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;%s:%d %s\t%s&quot;</span> <span class="token operator">%</span> <span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">,</span> ctime<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> msg<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">send</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        msg <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>
        skt<span class="token punctuation">.</span>sendto<span class="token punctuation">(</span>msg<span class="token punctuation">,</span> addr<span class="token punctuation">)</span>


skt<span class="token punctuation">:</span> socket <span class="token operator">=</span> <span class="token boolean">None</span>


<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">global</span> skt
    skt <span class="token operator">=</span> socket<span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> SOCK_DGRAM<span class="token punctuation">)</span>
    skt<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    ip <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">&quot;target ip:&quot;</span><span class="token punctuation">)</span>
    port <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">&quot;target port:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>receive<span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>send<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>ip<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h3 id="_3-2-udp-广播"><a href="#_3-2-udp-广播" class="header-anchor">#</a> 3.2 UDP 广播</h3> <p>UDP通讯中，我们想广播地址发送的数据，网络交换机会自动广播到当前网络中的所有地址。如局域网通讯软件，一个用户上线之后就可以广播上线信息，这样所有在线用户都可以收到他的上线通知。</p> <p>局域网中，主机号全部为1的地址为广播地址。如 192.168.0.0/24 网络广播地址为 192.168.0.255; 192.168.0.0/16 网络广播地址为 192.168.255.255。</p> <p>Python中使用UDP广播需要做简单配置，然后发送消息到广播地址即可，<code>&lt;broadcast&gt;</code>可以自动确定当前网络广播地址。</p> <div class="language-py line-numbers-mode"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br></div><pre class="language-py"><code><span class="token keyword">from</span> socket <span class="token keyword">import</span> <span class="token operator">*</span>

bd <span class="token operator">=</span> socket<span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> SOCK_DGRAM<span class="token punctuation">)</span>
bd<span class="token punctuation">.</span>setsockopt<span class="token punctuation">(</span>SOL_SOCKET<span class="token punctuation">,</span> SO_BROADCAST<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 设置广播</span>
bd<span class="token punctuation">.</span>sendto<span class="token punctuation">(</span><span class="token string">&quot;test broadcast&quot;</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;&lt;broadcast&gt;&quot;</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 发送到广播地址</span>
bd<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="_4-tftp"><a href="#_4-tftp" class="header-anchor">#</a> 4. TFTP</h2> <h3 id="_4-1-tftp-简介"><a href="#_4-1-tftp-简介" class="header-anchor">#</a> 4.1 TFTP 简介</h3> <p>TFTP（Trivial File Transfer Protocol,简单文件传输协议）是一个基于UDP协议的简单的、低开销的文件传输协议。使用端口号为69。TFTP常用于小容量存储的服务器，如路由器等。</p> <p>从网络服务器下载文件时，首先会在按照一定规则在本地创建一个空文件。服务器则会打开文件并逐次向客户端发送文件字节流，客户端接收到后将其写入之前创建的文件中，如此往复直到文件内容传输完成，即文件下载完成。文件上传过程与之类似，只是在服务端创建文件和传输方向不同。</p> <p><img src="https://i.loli.net/2020/02/25/NbASriBYkpXP1LM.jpg" alt="TFTP数据包格式"></p> <p>TFTP传输的数据包格式固定，如上图所示。传输中有三种模式：netascii，这是8位的ASCII码形式，另一种是octet，这是8位源数据类型；最后一种mail已经不再支持，它将返回的数据直接返回给用户而不是保存为文件。</p> <p>客户端第一次向服务器发送1(下载)/2(上传)操作码，同时请求文件。如果服务器找到文件会立即打开文件并通过TFTP协议发送给客户端。如果文件尺寸较大，服务器会分多次发送每次512B，为了让客户端对接收到的数据进行排序，在服务器发送数据的时候会多发2B数据，用来存放序号，序号是从1开始。</p> <p>因为udp的数据包不安全，即发送方发送是否成功不能确定，所以TFTP协议中规定，为了让服务器知道客户端已经接收到了刚刚发送的那个数据包，所以当客户端接收到一个数据包的时候需要向服务器进行发送确认信息，即发送收到了，这样的包成为ACK(应答包)。</p> <p>客户端接收到的数据小于516B(2B操作码+2B序号+512B数据),表示文件传输完成。如果最后一个数据包文件内容刚好512B，TFTP服务器会再发一次一个文件数据长度为0的包。</p> <p>TFTP服务器默认绑定端口为69，但开始文件内容传输后每次使用动态端口。</p> <blockquote><p><a href="/it/tftp">TFTP Server on mac</a></p></blockquote> <h3 id="_4-2-tftp-客户端开发"><a href="#_4-2-tftp-客户端开发" class="header-anchor">#</a> 4.2 TFTP 客户端开发</h3> <h4 id="_1）大端-小端"><a href="#_1）大端-小端" class="header-anchor">#</a> 1）大端 / 小端</h4> <p>内存单位的地址是有高低位不同顺序的。一个多字节对象也是有高低位的，如0x1122,11是高位,22是低位。多字节的内存对象一般会占用多个内存单位，此时对象在内存中的存储顺序就有两种选择。如过，对象低位存储使用低位内存，称为小端。反之，低位对象使用高位内存则称为大端。</p> <p>一般个人PC操作系统内存多使用小端存储方式，而大型服务器系统多使用大端。<strong>网络数据传输必须使用大端。</strong></p> <h4 id="_2）-字节对象-组包-拆包"><a href="#_2）-字节对象-组包-拆包" class="header-anchor">#</a> 2） 字节对象 组包 / 拆包</h4> <p>前面我们了解到，TFTP的传输的数据包(字节对象)是有格式的，不能直接传输字符串。我们需要按照其格式组包和拆包。不只TFTP，大多数的网络数据传输都对数据包要特定格式要求。</p> <p>Python的<code>struct</code>模块提供了<code>pack()</code>和<code>unpack()</code>两个函数分别用于组包和拆包。假定我们要组装一个数据包下载TFTP服务器的<code>test.txt</code>文件，可以按如下方式组包。</p> <div class="language-py line-numbers-mode"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-py"><code><span class="token keyword">from</span> struct <span class="token keyword">import</span> pack

pack<span class="token punctuation">(</span><span class="token string">&quot;!H8sb5sb&quot;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;test.txt&quot;</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;octet&quot;</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token triple-quoted-string string">&quot;&quot;&quot;
pack函数第一个参数为数据包格式，后面各参数填充各位置

1. '!'开头表示此为网络数据包,使用大端组织数据
2. 'H'表示整数占位2B，第二个参数1会占用2B
1. 's'表示字符占位1B，8s表示第三个参数test.txt占用8B
4. 'b'表示整数占位1B，第四个参数0占用1B
5. '5sb'分别为最后octet和0两个参数占位5B和1B
&quot;&quot;&quot;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="_3）tftp-客户端"><a href="#_3）tftp-客户端" class="header-anchor">#</a> 3）TFTP 客户端</h4> <p>下面我们使用Python来简单完成一个TFTP客户端。</p> <div class="language-py line-numbers-mode"><pre class="language-py"><code><span class="token keyword">from</span> socket <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> struct <span class="token keyword">import</span> pack<span class="token punctuation">,</span> unpack


<span class="token keyword">def</span> <span class="token function">download</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    rrq <span class="token operator">=</span> pack<span class="token punctuation">(</span><span class="token string">&quot;!H{}sb5sb&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">file</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">b&quot;octet&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment"># 构建下载请求</span>
    udp<span class="token punctuation">.</span>sendto<span class="token punctuation">(</span>rrq<span class="token punctuation">,</span> <span class="token punctuation">(</span>ip<span class="token punctuation">,</span> <span class="token number">69</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 发送下载文件请求</span>

    chunk <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># 本地模块号</span>
    recv_file <span class="token operator">=</span> <span class="token boolean">None</span>

    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        recv_data<span class="token punctuation">,</span> recv_addr <span class="token operator">=</span> udp<span class="token punctuation">.</span>recvfrom<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
        recv_len <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>recv_data<span class="token punctuation">)</span>
        code_chunk <span class="token operator">=</span> unpack<span class="token punctuation">(</span><span class="token string">&quot;!HH&quot;</span><span class="token punctuation">,</span> recv_data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        code <span class="token operator">=</span> code_chunk<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>  <span class="token comment"># 操作码</span>
        current_chunk <span class="token operator">=</span> code_chunk<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>  <span class="token comment"># 模块号</span>

        <span class="token keyword">if</span> code <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">:</span>  <span class="token comment"># 数据包</span>
            <span class="token keyword">if</span> current_chunk <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>  <span class="token comment"># 如果是第一次接收到数据，那么就创建文件</span>
                recv_file <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token string">&quot;ab&quot;</span><span class="token punctuation">)</span>

            <span class="token keyword">if</span> chunk <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">==</span> current_chunk<span class="token punctuation">:</span>  <span class="token comment"># 校验模块号</span>
                recv_file<span class="token punctuation">.</span>write<span class="token punctuation">(</span>recv_data<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                chunk <span class="token operator">+=</span> <span class="token number">1</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;第{}次接收到数据 {} byte(s)&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>chunk<span class="token punctuation">,</span> recv_len<span class="token punctuation">)</span><span class="token punctuation">)</span>
                ack <span class="token operator">=</span> pack<span class="token punctuation">(</span><span class="token string">&quot;!HH&quot;</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> chunk<span class="token punctuation">)</span>
                udp<span class="token punctuation">.</span>sendto<span class="token punctuation">(</span>ack<span class="token punctuation">,</span> recv_addr<span class="token punctuation">)</span>

            <span class="token keyword">if</span> recv_len <span class="token operator">&lt;</span> <span class="token number">516</span><span class="token punctuation">:</span>  <span class="token comment"># 判断是否完成</span>
                recv_file<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'文件下载成功'</span><span class="token punctuation">)</span>
                <span class="token keyword">break</span>

        <span class="token keyword">elif</span> code <span class="token operator">==</span> <span class="token number">5</span><span class="token punctuation">:</span>  <span class="token comment"># 错误应答</span>
            <span class="token punctuation">(</span>error_msg<span class="token punctuation">,</span><span class="token punctuation">)</span> <span class="token operator">=</span> unpack<span class="token punctuation">(</span><span class="token string">&quot;!{}s&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>recv_len <span class="token operator">-</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> recv_data<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span>recv_len<span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;error occured at chunk-{}.error message:{}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>current_chunk<span class="token punctuation">,</span> error_msg<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>


<span class="token keyword">def</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    wrq <span class="token operator">=</span> pack<span class="token punctuation">(</span><span class="token string">&quot;!H{}sb5sb&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token builtin">file</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">b&quot;octet&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment"># 构建上传请求</span>
    udp<span class="token punctuation">.</span>sendto<span class="token punctuation">(</span>wrq<span class="token punctuation">,</span> <span class="token punctuation">(</span>ip<span class="token punctuation">,</span> <span class="token number">69</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 发送下载上传请求</span>

    chunk <span class="token operator">=</span> <span class="token number">1</span>  <span class="token comment"># 本地模块号</span>
    send_file <span class="token operator">=</span> <span class="token boolean">None</span>

    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        recv_data<span class="token punctuation">,</span> recv_addr <span class="token operator">=</span> udp<span class="token punctuation">.</span>recvfrom<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
        code<span class="token punctuation">,</span> current_chunk <span class="token operator">=</span> unpack<span class="token punctuation">(</span><span class="token string">&quot;!HH&quot;</span><span class="token punctuation">,</span> recv_data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> code <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">:</span>  <span class="token comment"># ACK</span>
            <span class="token keyword">if</span> current_chunk <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>  <span class="token comment"># 如果是第一次，那么就打开文件</span>
                send_file <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token string">&quot;rb&quot;</span><span class="token punctuation">)</span>

            <span class="token keyword">if</span> current_chunk <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">==</span> chunk<span class="token punctuation">:</span>  <span class="token comment"># 校验模块号</span>
                data <span class="token operator">=</span> send_file<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span>  <span class="token comment"># 读取 512 byte数据</span>
                send_data <span class="token operator">=</span> pack<span class="token punctuation">(</span><span class="token string">&quot;!HH{}s&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> chunk<span class="token punctuation">,</span> data<span class="token punctuation">)</span>
                udp<span class="token punctuation">.</span>sendto<span class="token punctuation">(</span>send_data<span class="token punctuation">,</span> recv_addr<span class="token punctuation">)</span>  <span class="token comment"># 打包发送数据</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;第{}次数据已发送 {} byte(s)&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>chunk<span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>send_data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                chunk <span class="token operator">+=</span> <span class="token number">1</span>

                <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>  <span class="token comment"># 判断文件是否读取完成</span>
                    send_file<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;文件上传完成...&quot;</span><span class="token punctuation">)</span>
                    <span class="token keyword">break</span>

        <span class="token keyword">elif</span> code <span class="token operator">==</span> <span class="token number">5</span><span class="token punctuation">:</span>  <span class="token comment"># 错误应答</span>
            recv_len <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>recv_data<span class="token punctuation">)</span>
            <span class="token punctuation">(</span>error_msg<span class="token punctuation">,</span><span class="token punctuation">)</span> <span class="token operator">=</span> unpack<span class="token punctuation">(</span><span class="token string">&quot;!{}s&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>recv_len <span class="token operator">-</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> recv_data<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span>recv_len<span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;error occured at chunk-{}.error message:{}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>current_chunk<span class="token punctuation">,</span> error_msg<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>


ip <span class="token operator">=</span> <span class="token string">''</span>
udp <span class="token operator">=</span> <span class="token boolean">None</span>


<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">global</span> ip<span class="token punctuation">,</span> udp

    ip <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">&quot;please type the hostname of TFTP server:\n&quot;</span><span class="token punctuation">)</span>
    udp <span class="token operator">=</span> socket<span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> SOCK_DGRAM<span class="token punctuation">)</span>  <span class="token comment"># 创建udp套接字</span>
    udp<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        act <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">&quot;please choose what to do?\n1:download\n2:upload\n3:quit\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> act <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
            <span class="token builtin">file</span> <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">&quot;type the name of the file you wanna download...\n&quot;</span><span class="token punctuation">)</span>
            download<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> act <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">:</span>
            <span class="token builtin">file</span> <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">&quot;type the name of the file you wanna upload...\n&quot;</span><span class="token punctuation">)</span>
            upload<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> act <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">:</span>
            <span class="token keyword">break</span>

    udp<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br></div></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">8/18/2020, 2:30:13 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/python/senior/network.html" class="prev">
        网络通信
      </a></span> <span class="next"><a href="/python/senior/tcp.html">
        TCP
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/python/assets/js/app.e1ee403d.js" defer></script><script src="/python/assets/js/2.968a03f5.js" defer></script><script src="/python/assets/js/48.e81f8b9b.js" defer></script>
  </body>
</html>
