(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{377:function(s,t,n){"use strict";n.r(t);var a=n(25),e=Object(a.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"redis"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#redis"}},[s._v("#")]),s._v(" Redis")]),s._v(" "),n("h2",{attrs:{id:"_1-redis-交互"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-redis-交互"}},[s._v("#")]),s._v(" 1. Redis 交互")]),s._v(" "),n("p",[s._v("本节我们来简单演示如何使用"),n("code",[s._v("redis")]),s._v("扩展包与Redis服务交互。")]),s._v(" "),n("blockquote",[n("p",[s._v("更详尽的Redis资料，请参阅 "),n("a",{attrs:{href:"https://architecture.ccstudio.org/nosql/redis.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://architecture.ccstudio.org/nosql/redis.html"),n("OutboundLink")],1)])]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装 redis 扩展包")]),s._v("\npip3 "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" redis\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[n("code",[s._v("redis")]),s._v("扩展包中提供了"),n("code",[s._v("StrictRedis")]),s._v("对象，⽤于连接Redis服务器，它同时按Redis不同数据类型提供了对应的交互接口。")]),s._v(" "),n("div",{staticClass:"language-py line-numbers-mode"},[n("div",{staticClass:"highlight-lines"},[n("div",{staticClass:"highlighted"},[s._v(" ")]),n("br"),n("br"),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("br"),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("br"),n("br"),n("br")]),n("pre",{pre:!0,attrs:{class:"language-py"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" redis "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" StrictRedis\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建redis连接")]),s._v("\nsr "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" StrictRedis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("host"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.0.200"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" password"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"123123"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1. 设值")]),s._v("\nres "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" sr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("set")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Colin"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# True")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2. 取值")]),s._v("\nname "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" sr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 取值 字符串. 若不不存在则返回None")]),s._v("\nname "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("decode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" name "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 'Colin'")]),s._v("\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("p",[s._v("需要注意的是，"),n("code",[s._v("redis-py")]),s._v("默认维护了Reids连接池，一般不需要我们单独处理连接建立和关闭的问题。以下摘自其官方文档。"),n("a",{attrs:{href:"https://pypi.org/project/redis/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Behind the scenes, redis-py uses a connection pool to manage connections to a Redis server. By default, each Redis instance you create will in turn create its own connection pool."),n("OutboundLink")],1)]),s._v(" "),n("p",[n("code",[s._v("redis")]),s._v("提供的数据类型操作接口基本与Redis命令一致。")]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("类型")]),n("th",[s._v("方法")]),n("th",[s._v("说明")]),n("th",[s._v("示例")])])]),s._v(" "),n("tbody",[n("tr",[n("td",{attrs:{rowspan:"6"}},[n("code",[s._v("key")])]),n("td",[n("code",[s._v("keys")])]),n("td",[s._v("查所有键(可过滤)")]),n("td",[n("code",[s._v("sr.keys(\"n\")  # 名称包含'n'的key")])])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("exists")])]),n("td",[s._v("判断key是否存在")]),n("td",[n("code",[s._v('sr.exists("name")')])])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("type")])]),n("td",[s._v("查看key对应value类型")]),n("td",[n("code",[s._v('sr.type("name")')])])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("delete")])]),n("td",[s._v("删除键及对应的值")]),n("td",[n("code",[s._v('sr.delete("name", "age")')])])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("expire")])]),n("td",[s._v("设置过期时间(秒)")]),n("td",[n("code",[s._v('sr.expire("name",3)')])])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("ttl")])]),n("td",[s._v("查看有效时间(秒)")]),n("td",[n("code",[s._v('sr.ttl("name")')])])]),s._v(" "),n("tr",[n("td",{attrs:{rowspan:"6"}},[n("code",[s._v("string")])]),n("td",[n("code",[s._v("set")])]),n("td",[s._v("设值")]),n("td",[n("code",[s._v('sr.set("name","Colin")')])])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("setex")])]),n("td",[s._v("设值及过期时间(秒)")]),n("td",[n("code",[s._v('sr.setex("name",3,"Colin")')])])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("mset")])]),n("td",[s._v("设多键值")]),n("td",[n("code",[s._v('sr.mset({"name": "Colin", "age": 18})')])])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("append")])]),n("td",[s._v("追加值")]),n("td",[n("code",[s._v('sr.append("name"," Chang")')])])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("get")])]),n("td",[s._v("取值")]),n("td",[n("code",[s._v('sr.get("name")')])])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("mget")])]),n("td",[s._v("取多值")]),n("td",[n("code",[s._v('sr.mget("name", "age")')])])]),s._v(" "),n("tr",[n("td",{attrs:{rowspan:"6"}},[n("code",[s._v("list")])]),n("td",[n("code",[s._v("lpush")])]),n("td",[s._v("左侧插⼊数据")]),n("td",[n("code",[s._v('sr.lpush("orders","Colin")')])])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("rpush")])]),n("td",[s._v("右侧插⼊数据")]),n("td",[n("code",[s._v('sr.rpush("orders","Robin")')])])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("linsert")])]),n("td",[s._v("在指定元素的前或后插⼊新元素")]),n("td",[n("code",[s._v('sr.linsert("orders", "before", "Robin", "Sean")  # 在\'Robin\'前插入\'Sean\'')])])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("lrange")])]),n("td",[s._v("返回列表⾥指定范围的元素")]),n("td",[n("code",[s._v('sr.lrange("orders", 1, -2)  # 返回第1个元素之后到倒数第2个列表元素')])])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("lset")])]),n("td",[s._v("设置指定位置元素值")]),n("td",[n("code",[s._v('sr.lset("orders",1,"Tom")')])])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("lrem")])]),n("td",[s._v("删除指定元素")]),n("td",[n("code",[s._v('sr.lrem("orders", -2, "Tom")  # 从右侧开始向左删除连个值为\'Tom\'的元素')])])]),s._v(" "),n("tr",[n("td",{attrs:{rowspan:"3"}},[n("code",[s._v("set")])]),n("td",[n("code",[s._v("sadd")])]),n("td",[s._v("添加元素")]),n("td",[n("code",[s._v('sr.sadd("boys", "Colin", "Robin")')])])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("smembers")])]),n("td",[s._v("返回所有的元素")]),n("td",[n("code",[s._v('sr.smembers("boys")')])])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("srem")])]),n("td",[s._v("删除指定元素")]),n("td",[n("code",[s._v('sr.srem("boys", "Robin")')])])]),s._v(" "),n("tr",[n("td",{attrs:{rowspan:"6"}},[n("code",[s._v("zset")])]),n("td",[n("code",[s._v("zadd")])]),n("td",[s._v("添加元素")]),n("td",[n("code",[s._v('sr.zadd("students", {"Colin": 100, "Robin": 95})')])])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("zrange")])]),n("td",[s._v("返回指定范围的元素")]),n("td",[n("code",[s._v('sr.zrange("students",0,-1)')])])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("zrangebyscore")])]),n("td",[s._v("返回指定score值范围的成员")]),n("td",[n("code",[s._v('sr.zrangebyscore("students",95,100)')])])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("zscore")])]),n("td",[s._v("返回指定成员score值")]),n("td",[n("code",[s._v('sr.zscore("students","Colin")')])])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("zrem")])]),n("td",[s._v("删除指定元素")]),n("td",[n("code",[s._v('sr.zrem("students","Robin")')])])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("zremrangebyscore")])]),n("td",[s._v("删除指定score范围的元素")]),n("td",[n("code",[s._v('sr.zremrangebyscore("student", 0, 60)')])])]),s._v(" "),n("tr",[n("td",{attrs:{rowspan:"7"}},[n("code",[s._v("hash")])]),n("td",[n("code",[s._v("hset")])]),n("td",[s._v("设置单个属性")]),n("td",[n("code",[s._v('sr.hset("mvp", "name", "Colin")')])])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("hmset")])]),n("td",[s._v("设置多个属性")]),n("td",[n("code",[s._v('sr.hmset("mvp", {"age": 18, "gender": "male"})')])])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("hkeys")])]),n("td",[s._v("获取所有属性名")]),n("td",[n("code",[s._v('sr.hkeys("mvp")')])])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("hget")])]),n("td",[s._v("获取⼀个属性值")]),n("td",[n("code",[s._v('sr.hget("mvp", "name")')])])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("hmget")])]),n("td",[s._v("获取多个属性值")]),n("td",[n("code",[s._v('sr.hmget("mvp", "name", "age")')])])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("hvals")])]),n("td",[s._v("获取所有属性的值")]),n("td",[n("code",[s._v('sr.hvals("mvp")')])])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("hdel")])]),n("td",[s._v("删除属性")]),n("td",[n("code",[s._v('sr.hdel("mvp", "gender")')])])])])]),s._v(" "),n("h2",{attrs:{id:"_2-redis-集群交互"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-redis-集群交互"}},[s._v("#")]),s._v(" 2. Redis 集群交互")]),s._v(" "),n("h3",{attrs:{id:"_2-1-redis-sentinel"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-redis-sentinel"}},[s._v("#")]),s._v(" 2.1 redis-sentinel")]),s._v(" "),n("p",[s._v("redis-sentinel更多内容请参阅 "),n("a",{attrs:{href:"https://ccstudio.org/python/nosql/redis.html#_2-3-redis-sentinel",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://ccstudio.org/python/nosql/redis.html#_2-3-redis-sentinel"),n("OutboundLink")],1)]),s._v(" "),n("div",{staticClass:"language-py line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-py"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sentinel "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" Sentinel\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 连接哨兵服务器(主机名也可以用域名)")]),s._v("\nsentinel "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Sentinel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'192.168.0.225'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("26379")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                     "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'192.168.0.225'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("26380")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                     "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'192.168.0.225'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("26381")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取主服务器地址")]),s._v("\nmaster "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" sentinel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("discover_master"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'redis-service'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("master"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取从服务器地址")]),s._v("\nslaves "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" sentinel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("discover_slaves"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'redis-service'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("slaves"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取主服务器进行写入")]),s._v("\nmaster "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" sentinel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("master_for"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'redis-service'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nmaster"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("set")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'comment'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("b'handsome'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# # 获取从服务器进行读取（默认是round-roubin）")]),s._v("\nslave "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" sentinel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("slave_for"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'redis-service'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ncomment "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" slave"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'comment'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("comment"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br")])]),n("h3",{attrs:{id:"_2-2-redis-cluster"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-redis-cluster"}},[s._v("#")]),s._v(" 2.2 redis-cluster")]),s._v(" "),n("p",[s._v("使用"),n("code",[s._v("redis-py-cluster")]),s._v("扩展包可以实现Redis集群交互。")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装 redis-py-cluster 扩展包")]),s._v("\npip3 "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" redis-py-cluster\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("除了Redis连接对象不同，其他操作与单节点交互无异。")]),s._v(" "),n("div",{staticClass:"language-py line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-py"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" rediscluster "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" RedisCluster\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 集群节点列表")]),s._v("\nredis_nodes "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'host'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'192.168.26.128'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'port'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'7000'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'host'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'192.168.26.130'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'port'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'7003'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'host'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'192.168.26.128'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'port'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'7001'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建集群连接")]),s._v("\nrc "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" RedisCluster"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("startup_nodes"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("redis_nodes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" decode_responses"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1. 设值")]),s._v("\nres "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" rc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("set")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Colin"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# True")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2. 取值")]),s._v("\nname "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" rc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 取值 字符串. 若不不存在则返回None")]),s._v("\nname "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("decode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" name "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 'Colin'")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("blockquote",[n("p",[s._v("Redis集群环境搭建参阅 "),n("a",{attrs:{href:"https://ccstudio.org/python/nosql/redis.html#_2-4-redis-cluster",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://ccstudio.org/python/nosql/redis.html#_2-4-redis-cluster"),n("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=e.exports}}]);